"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2282],{51509:(ee,I,s)=>{s.r(I),s.d(I,{ProvidersPage:()=>he,default:()=>Qe});var e=s(32735),R=s(5636),i=s(484),j=s(23973),Z=s.n(j),S=s(23940),w=s.n(S),g=s(16925),y=s(11856),E=s(16540),F=s(29270),u=s(53214),b=s(95602),B=s(28004),T=s(20763),L=s(95717),x=s.n(L),W=s(84968),o=s(5173),c=s(59677);const te={id:(0,c.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},re={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},H={id:(0,c.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},V={id:(0,c.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},ae={id:(0,c.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},se={id:(0,c.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},A={id:(0,c.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},ne={id:(0,c.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},G={email:{form:[[{intlLabel:V,name:"enabled",type:"bool",description:H,size:6}]],schema:o.Ry().shape({enabled:o.Xg().required(i.translatedErrors.required)})},providers:{form:[[{intlLabel:V,name:"enabled",type:"bool",description:H,size:6,validations:{required:!0}}],[{intlLabel:ae,name:"key",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:ne,name:"secret",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:re,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:se,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(i.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:V,name:"enabled",type:"bool",description:H,size:6,validations:{required:!0}}],[{intlLabel:ae,name:"key",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:ne,name:"secret",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,c.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,c.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:re,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:se,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(i.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),subdomain:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()})})}};var be=(t,r,a)=>new Promise((p,m)=>{var P=d=>{try{h(a.next(d))}catch(l){m(l)}},v=d=>{try{h(a.throw(d))}catch(l){m(l)}},h=d=>d.done?p(d.value):Promise.resolve(d.value).then(P,v);h((a=a.apply(t,r)).next())});const Ee=t=>be(void 0,null,function*(){try{const{data:r}=yield c.be.get((0,c.Gc)("providers"));return r}catch(r){throw t({type:"warning",message:{id:"notification.error"}}),new Error("error")}}),Oe=t=>c.be.put((0,c.Gc)("providers"),t);var Me=s(92891);const Te=["envelope","user","book"],Le=t=>(0,Me.sortBy)(Object.keys(t).reduce((r,a)=>{const{icon:p,enabled:m,subdomain:P}=t[a],v=Te.indexOf(p)>=0?["fas",p]:["fab",p];return P!==void 0?r.push({name:a,icon:v,enabled:m,subdomain:P}):r.push({name:a,icon:v,enabled:m}),r},[]),"name");var oe=s(88369),le=s(44526),Re=s(90662),ie=s(71657),de=s(78330),N=s(4122),Be=s(60216),n=s.n(Be),Ce=s(83281),Ie=s(63865),Se=s(37178),Fe=Object.defineProperty,ue=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable,ce=(t,r,a)=>r in t?Fe(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,X=(t,r)=>{for(var a in r||(r={}))Ue.call(r,a)&&ce(t,a,r[a]);if(ue)for(var a of ue(r))Ze.call(r,a)&&ce(t,a,r[a]);return t};const $=({description:t,disabled:r,intlLabel:a,error:p,name:m,onChange:P,placeholder:v,providerToEditName:h,type:d,value:l})=>{const{formatMessage:O}=(0,R.useIntl)(),C=m==="noName"?`${strapi.backendURL}/api/connect/${h}/callback`:l,U=O({id:a.id,defaultMessage:a.defaultMessage},X({provider:h},a.values)),M=t?O({id:t.id,defaultMessage:t.defaultMessage},X({provider:h},t.values)):"";if(d==="bool")return e.createElement(Ie.ToggleInput,{"aria-label":m,checked:l,disabled:r,hint:M,label:U,name:m,offLabel:O({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:O({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:D=>{P({target:{name:m,value:D.target.checked}})}});const k=v?O({id:v.id,defaultMessage:v.defaultMessage},X({},v.values)):"",Y=p?O({id:p,defaultMessage:p}):"";return e.createElement(Se.TextInput,{"aria-label":m,disabled:r,error:Y,label:U,name:m,onChange:P,placeholder:k,type:d,value:C})};$.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},$.propTypes={description:n().shape({id:n().string.isRequired,defaultMessage:n().string.isRequired,values:n().object}),disabled:n().bool,error:n().string,intlLabel:n().shape({id:n().string.isRequired,defaultMessage:n().string.isRequired,values:n().object}).isRequired,name:n().string.isRequired,onChange:n().func.isRequired,placeholder:n().shape({id:n().string.isRequired,defaultMessage:n().string.isRequired,values:n().object}),providerToEditName:n().string.isRequired,type:n().string.isRequired,value:n().oneOfType([n().bool,n().string])};const we=$;var xe=Object.defineProperty,De=Object.defineProperties,je=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable,pe=(t,r,a)=>r in t?xe(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,ze=(t,r)=>{for(var a in r||(r={}))Ae.call(r,a)&&pe(t,a,r[a]);if(me)for(var a of me(r))Ne.call(r,a)&&pe(t,a,r[a]);return t},qe=(t,r)=>De(t,je(r));const K=({headerBreadcrumbs:t,initialData:r,isSubmiting:a,layout:p,isOpen:m,onSubmit:P,onToggle:v,providerToEditName:h})=>{const{formatMessage:d}=(0,R.useIntl)();return m?e.createElement(N.ModalLayout,{onClose:v,labelledBy:"title"},e.createElement(N.ModalHeader,null,e.createElement(ie.Breadcrumbs,{label:t.join(", ")},t.map(l=>e.createElement(ie.Crumb,{key:l},l)))),e.createElement(Ce.Formik,{onSubmit:l=>P(l),initialValues:r,validationSchema:p.schema,validateOnChange:!1},({errors:l,handleChange:O,values:C})=>e.createElement(i.Form,null,e.createElement(N.ModalBody,null,e.createElement(Re.Stack,{spacing:1},e.createElement(de.Grid,{gap:5},p.form.map(U=>U.map(M=>e.createElement(de.GridItem,{key:M.name,col:M.size,xs:12},e.createElement(we,qe(ze({},M),{error:l[M.name],onChange:O,value:C[M.name],providerToEditName:h})))))))),e.createElement(N.ModalFooter,{startActions:e.createElement(le.Button,{variant:"tertiary",onClick:v,type:"button"},d({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(le.Button,{type:"submit",loading:a},d({id:"global.save",defaultMessage:"Save"}))})))):null};K.defaultProps={initialData:null,providerToEditName:null},K.propTypes={headerBreadcrumbs:n().arrayOf(n().string).isRequired,initialData:n().object,layout:n().shape({form:n().arrayOf(n().array),schema:n().object}).isRequired,isOpen:n().bool.isRequired,isSubmiting:n().bool.isRequired,onSubmit:n().func.isRequired,onToggle:n().func.isRequired,providerToEditName:n().string};const We=K;var He=Object.defineProperty,Ve=Object.defineProperties,Ge=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,Xe=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,fe=(t,r,a)=>r in t?He(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,Q=(t,r)=>{for(var a in r||(r={}))Xe.call(r,a)&&fe(t,a,r[a]);if(ve)for(var a of ve(r))$e.call(r,a)&&fe(t,a,r[a]);return t},Ke=(t,r)=>Ve(t,Ge(r)),ge=(t,r,a)=>new Promise((p,m)=>{var P=d=>{try{h(a.next(d))}catch(l){m(l)}},v=d=>{try{h(a.throw(d))}catch(l){m(l)}},h=d=>d.done?p(d.value):Promise.resolve(d.value).then(P,v);h((a=a.apply(t,r)).next())});const he=()=>{const{formatMessage:t}=(0,R.useIntl)();(0,i.useFocusWhenNavigate)();const{notifyStatus:r}=(0,F.useNotifyAT)(),a=(0,W.useQueryClient)(),{trackUsage:p}=(0,i.useTracking)(),m=(0,e.useRef)(p),[P,v]=(0,e.useState)(!1),[h,d]=(0,e.useState)(!1),[l,O]=(0,e.useState)(null),C=(0,i.useNotification)(),{lockApp:U,unlockApp:M}=(0,i.useOverlayBlocker)(),k=(0,e.useMemo)(()=>({update:oe.Z.updateProviders}),[]),{isLoading:Y,allowedActions:{canUpdate:D}}=(0,i.useRBAC)(k),{isLoading:ke,data:z,isFetching:Ye}=(0,W.useQuery)("get-providers",()=>Ee(C),{onSuccess(){r(t({id:(0,c.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),Je=ke||Ye,_e=(0,W.useMutation)(Oe,{onSuccess(){return ge(this,null,function*(){yield a.invalidateQueries("get-providers"),C({type:"info",message:{id:(0,c.OB)("notification.success.submit")}}),m.current("didEditAuthenticationProvider"),d(!1),J(),M()})},onError(){C({type:"warning",message:{id:"notification.error"}}),M(),d(!1)},refetchActive:!1}),q=(0,e.useMemo)(()=>Le(z),[z]),et=q.length,ye=(0,e.useMemo)(()=>{if(!l)return!1;const f=q.find(_=>_.name===l);return Z()(f,"subdomain")},[q,l]),tt=t({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),rt=(0,e.useMemo)(()=>l==="email"?G.email:ye?G.providersWithSubdomain:G.providers,[l,ye]),J=()=>{v(f=>!f)},Pe=f=>{D&&(O(f.name),J())},at=f=>ge(void 0,null,function*(){d(!0),U(),m.current("willEditAuthenticationProvider");const _=Ke(Q({},z),{[l]:f});_e.mutate({providers:_})});return e.createElement(y.Layout,null,e.createElement(i.SettingsPageTitle,{name:tt}),e.createElement(E.Main,null,e.createElement(y.HeaderLayout,{title:t({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),Je||Y?e.createElement(i.LoadingIndicatorPage,null):e.createElement(y.ContentLayout,null,e.createElement(u.Table,{colCount:4,rowCount:et+1},e.createElement(u.Thead,null,e.createElement(u.Tr,null,e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma",textColor:"neutral600"},e.createElement(B.VisuallyHidden,null,t({id:(0,c.OB)("Providers.image"),defaultMessage:"Image"})))),e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma",textColor:"neutral600"},t({id:"global.name",defaultMessage:"Name"}))),e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma",textColor:"neutral600"},t({id:(0,c.OB)("Providers.status"),defaultMessage:"Status"}))),e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma"},e.createElement(B.VisuallyHidden,null,t({id:"global.settings",defaultMessage:"Settings"})))))),e.createElement(u.Tbody,null,q.map(f=>e.createElement(u.Tr,Q({key:f.name},(0,i.onRowClick)({fn:()=>Pe(f),condition:D})),e.createElement(u.Td,{width:""},e.createElement(g.G,{icon:f.icon})),e.createElement(u.Td,{width:"45%"},e.createElement(b.Typography,{fontWeight:"semiBold",textColor:"neutral800"},f.name)),e.createElement(u.Td,{width:"65%"},e.createElement(b.Typography,{textColor:f.enabled?"success600":"danger600","data-testid":`enable-${f.name}`},f.enabled?t({id:"global.enabled",defaultMessage:"Enabled"}):t({id:"global.disabled",defaultMessage:"Disabled"}))),e.createElement(u.Td,Q({},i.stopPropagation),D&&e.createElement(T.IconButton,{onClick:()=>Pe(f),noBorder:!0,icon:e.createElement(x(),null),label:"Edit"})))))))),e.createElement(We,{initialData:z[l],isOpen:P,isSubmiting:h,layout:rt,headerBreadcrumbs:[t({id:(0,c.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),w()(l)],onToggle:J,onSubmit:at,providerToEditName:l}))},Qe=()=>e.createElement(i.CheckPagePermissions,{permissions:oe.Z.readProviders},e.createElement(he,null))},8917:(ee,I,s)=>{s.d(I,{Z:()=>w});var e=s(43653),R=s.n(e),i=s(484),j=s.n(i),Z=(g,y,E)=>new Promise((F,u)=>{var b=L=>{try{T(E.next(L))}catch(x){u(x)}},B=L=>{try{T(E.throw(L))}catch(x){u(x)}},T=L=>L.done?F(L.value):Promise.resolve(L.value).then(b,B);T((E=E.apply(g,y)).next())});const S=R().create({baseURL:"http://localhost:1337"});S.interceptors.request.use(g=>Z(void 0,null,function*(){return g.headers={Authorization:`Bearer ${i.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},g}),g=>{Promise.reject(g)}),S.interceptors.response.use(g=>g,g=>{var y;throw((y=g.response)==null?void 0:y.status)===401&&(i.auth.clearAppStorage(),window.location.reload()),g});const w=S},59677:(ee,I,s)=>{s.d(I,{be:()=>e.Z,YX:()=>j,Gc:()=>w,OB:()=>g.Z});var e=s(8917),R=s(92891);const j=y=>Object.keys(y).reduce((E,F)=>{const u=y[F].controllers,b=Object.keys(u).reduce((B,T)=>((0,R.isEmpty)(u[T])||(B[T]=u[T]),B),{});return(0,R.isEmpty)(b)||(E[F]={controllers:b}),E},{});var Z=s(90201);const w=y=>`/${Z.Z}/${y}`;var g=s(82069)}}]);
