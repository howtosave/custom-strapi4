"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[4263],{45480:(k,A,e)=>{e.r(A),e.d(A,{default:()=>Se});var t=e(32735),o=e(484),c=e(5141),L=e(92891),v=e(10186),P=e(72975),m=e.n(P),C=e(5636),y=e(60216),O=e.n(y),x=e(88423),S=e.n(x),Y=e(33795),K=e.n(Y),Q=e(9086),V=e.n(Q),F=e(84968),b=e(83281),Z=e(9808),D=e(44526),M=e(78330),_=e(11856),w=e(95602),U=e(16540),j=e(90662),B=e(98599),R=e.n(B),s=e(88677),r=e.n(s),i=e(2139),ee=e(49986),z=(n,l,a)=>new Promise((d,u)=>{var h=p=>{try{W(a.next(p))}catch(g){u(g)}},E=p=>{try{W(a.throw(p))}catch(g){u(g)}},W=p=>p.done?d(p.value):Promise.resolve(p.value).then(h,E);W((a=a.apply(n,l)).next())});const ve=n=>z(void 0,null,function*(){const{data:l}=yield ee.be.get(`/admin/users/${n}`);return l.data}),Pe=(n,l)=>z(void 0,null,function*(){const{data:a}=yield ee.be.put(`/admin/users/${n}`,l);return a.data}),ye=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];var Me=e(29168),he=e(67446),Oe=e(98399);function De(n,l){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=_e(n))||l&&n&&typeof n.length=="number"){a&&(n=a);var d=0,u=function(){};return{s:u,n:function(){return d>=n.length?{done:!0}:{done:!1,value:n[d++]}},e:function(g){throw g},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,E=!1,W;return{s:function(){a=a.call(n)},n:function(){var g=a.next();return h=g.done,g},e:function(g){E=!0,W=g},f:function(){try{!h&&a.return!=null&&a.return()}finally{if(E)throw W}}}}function _e(n,l){if(!!n){if(typeof n=="string")return ne(n,l);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ne(n,l)}}function ne(n,l){(l==null||l>n.length)&&(l=n.length);for(var a=0,d=new Array(l);a<l;a++)d[a]=n[a];return d}var Ae=Object.defineProperty,Le=Object.defineProperties,Ie=Object.getOwnPropertyDescriptors,se=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,oe=function(l,a,d){return a in l?Ae(l,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[a]=d},le=function(l,a){for(var d in a||(a={}))Te.call(a,d)&&oe(l,d,a[d]);if(se){var u=De(se(a)),h;try{for(u.s();!(h=u.n()).done;){var d=h.value;Ce.call(a,d)&&oe(l,d,a[d])}}catch(E){u.e(E)}finally{u.f()}}return l},Ue=function(l,a){return Le(l,Ie(a))},Be=function(l,a,d){return new Promise(function(u,h){var E=function(N){try{p(d.next(N))}catch(X){h(X)}},W=function(N){try{p(d.throw(N))}catch(X){h(X)}},p=function(N){return N.done?u(N.value):Promise.resolve(N.value).then(E,W)};p((d=d.apply(l,a)).next())})},Re=function(){return window&&window.strapi&&window.strapi.isEE?e(27732).Z:e(10916).Z}(),ie=["email","firstname","lastname","username","isActive","roles"],de=function(l){var a=l.canUpdate,d=(0,C.useIntl)(),u=d.formatMessage,h=(0,c.useRouteMatch)("/settings/users/:id"),E=h.params.id,W=(0,c.useHistory)(),p=W.push,g=(0,o.useAppInfos)(),N=g.setUserDisplayName,X=(0,o.useNotification)(),ue=(0,o.useOverlayBlocker)(),Ke=ue.lockApp,be=ue.unlockApp;(0,o.useFocusWhenNavigate)();var ce=(0,F.useQuery)(["user",E],function(){return ve(E)},{retry:!1,keepPreviousData:!1,staleTime:1e3*20,onError:function(f){var $=f.response.status;$===403&&(X({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),p("/")),Oe.log(f.response.status)}}),Ze=ce.status,G=ce.data,we=function(f,$){return Be(void 0,null,m().mark(function J(){var q,ae,H,re,fe;return m().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return Ke(),I.prev=1,I.next=4,Pe(E,V()(f,"confirmPassword"));case 4:q=I.sent,X({type:"success",message:u({id:"notification.success.saved",defaultMessage:"Saved"})}),ae=o.auth.getUserInfo(),E.toString()===ae.id.toString()&&(o.auth.setUserInfo(q),H=K()(f,"username")||(0,i.Pp)(f.firstname,f.lastname),N(H)),$.setValues(S()(f,ie)),I.next=17;break;case 11:I.prev=11,I.t0=I.catch(1),re=(0,i.Iz)(I.t0.response.data),fe=Object.keys(re).reduce(function(Ee,ge){return Ee[ge]=re[ge].id,Ee},{}),$.setErrors(fe),X({type:"warning",message:K()(I.t0,"response.data.message","notification.error")});case 17:be();case 18:case"end":return I.stop()}},J,null,[[1,11]])}))},pe=Ze!=="success",je=pe?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},te=Object.keys(S()(G,ie)).reduce(function(T,f){return f==="roles"?(T[f]=((G==null?void 0:G.roles)||[]).map(function($){var J=$.id;return J}),T):(T[f]=G==null?void 0:G[f],T)},{}),ze=te.username||(0,i.Pp)(te.firstname,te.lastname),me=u(je,{name:ze});return pe?t.createElement(U.Main,{"aria-busy":"true"},t.createElement(o.SettingsPageTitle,{name:"Users"}),t.createElement(_.HeaderLayout,{primaryAction:t.createElement(D.Button,{disabled:!0,startIcon:t.createElement(r(),null),type:"button",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:me,navigationAction:t.createElement(o.Link,{startIcon:t.createElement(R(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(_.ContentLayout,null,t.createElement(o.LoadingIndicatorPage,null))):t.createElement(U.Main,null,t.createElement(o.SettingsPageTitle,{name:"Users"}),t.createElement(b.Formik,{onSubmit:we,initialValues:te,validateOnChange:!1,validationSchema:Me.YM},function(T){var f=T.errors,$=T.values,J=T.handleChange,q=T.isSubmitting;return t.createElement(o.Form,null,t.createElement(_.HeaderLayout,{primaryAction:t.createElement(D.Button,{disabled:q||!a,startIcon:t.createElement(r(),null),loading:q,type:"submit",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:me,navigationAction:t.createElement(o.Link,{startIcon:t.createElement(R(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(_.ContentLayout,null,(G==null?void 0:G.registrationToken)&&t.createElement(Z.Box,{paddingBottom:6},t.createElement(Re,{registrationToken:G.registrationToken})),t.createElement(j.Stack,{spacing:7},t.createElement(Z.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(j.Stack,{spacing:4},t.createElement(w.Typography,{variant:"delta",as:"h2"},u({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(M.Grid,{gap:5},ye.map(function(ae){return ae.map(function(H){return t.createElement(M.GridItem,le({key:H.name},H.size),t.createElement(o.GenericInput,Ue(le({},H),{disabled:!a,error:f[H.name],onChange:J,value:$[H.name]||""})))})})))),t.createElement(Z.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(j.Stack,{spacing:4},t.createElement(w.Typography,{variant:"delta",as:"h2"},u({id:"global.roles",defaultMessage:"User's role"})),t.createElement(M.Grid,{gap:5},t.createElement(M.GridItem,{col:6,xs:12},t.createElement(he.Z,{disabled:!a,error:f.roles,onChange:J,value:$.roles}))))))))}))};de.propTypes={canUpdate:O().bool.isRequired};const We=de,Se=()=>{const n=(0,o.useNotification)(),l=(0,t.useMemo)(()=>({read:v.Z.settings.users.read,update:v.Z.settings.users.update}),[]),{isLoading:a,allowedActions:{canRead:d,canUpdate:u}}=(0,o.useRBAC)(l),{state:h}=(0,c.useLocation)(),E=(0,L.get)(h,"from","/");return(0,t.useEffect)(()=>{a||!d&&!u&&n({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[a,d,u,n]),a?t.createElement(o.LoadingIndicatorPage,null):!d&&!u?t.createElement(c.Redirect,{to:E}):t.createElement(We,{canUpdate:u})}},68325:(k,A,e)=>{e.d(A,{Z:()=>Q});var t=e(32735),o=e(60216),c=e.n(o),L=e(20763),v=e.n(L),P=e(484),m=e.n(P),C=e(68192),y=e.n(C),O=e(59087),x=e.n(O),S=e(5636);const Y=()=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},t.createElement("text",{transform:"translate(-23 -9)",fill:"#4B515A",fillRule:"evenodd",fontSize:"32",fontFamily:"AppleColorEmoji, Apple Color Emoji"},t.createElement("tspan",{x:"23",y:"36"},"\u2709\uFE0F"))),K=({children:V,target:F})=>{const b=(0,P.useNotification)(),{formatMessage:Z}=(0,S.useIntl)(),D=()=>{b({type:"info",message:{id:"notification.link-copied"}})},M=Z({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(P.ContentBox,{endAction:t.createElement(O.CopyToClipboard,{onCopy:D,text:F},t.createElement(L.IconButton,{label:M,noBorder:!0,icon:t.createElement(y(),null)})),title:F,titleEllipsis:!0,subtitle:V,icon:t.createElement(Y,null),iconBackground:"neutral100"})};K.propTypes={children:c().oneOfType([c().element,c().string]).isRequired,target:c().string.isRequired};const Q=K},10916:(k,A,e)=>{e.d(A,{Z:()=>C});var t=e(32735),o=e(5636),c=e(60216),L=e.n(c),v=e(83864),P=e(68325);const m=({registrationToken:y})=>{const{formatMessage:O}=(0,o.useIntl)(),x=`${window.location.origin}${v.Z}auth/register?registrationToken=${y}`;return t.createElement(P.Z,{target:x},O({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};m.defaultProps={registrationToken:""},m.propTypes={registrationToken:L().string};const C=m},67446:(k,A,e)=>{e.d(A,{Z:()=>Z});var t=e(32735),o=e(60216),c=e.n(o),L=e(5636),v=e(25716),P=e.n(v),m=e(84968),C=e.n(m),y=e(19615),O=e(103),x=e.n(O),S=e(49986),Y=(D,M,_)=>new Promise((w,U)=>{var j=s=>{try{R(_.next(s))}catch(r){U(r)}},B=s=>{try{R(_.throw(s))}catch(r){U(r)}},R=s=>s.done?w(s.value):Promise.resolve(s.value).then(j,B);R((_=_.apply(D,M)).next())});const K=y.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,Q=y.default.div`
  animation: ${K} 2s infinite linear;
`,V=()=>t.createElement(Q,null,t.createElement(x(),null)),F=()=>Y(void 0,null,function*(){const{data:D}=yield S.be.get("/admin/roles");return D.data}),b=({disabled:D,error:M,onChange:_,value:w})=>{const{status:U,data:j}=(0,m.useQuery)(["roles"],F,{staleTime:5e4}),{formatMessage:B}=(0,L.useIntl)(),R=M?B({id:M,defaultMessage:M}):"",s=B({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),r=B({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),i=B({id:"app.components.Select.placeholder",defaultMessage:"Select"}),ee=U==="loading"?t.createElement(V,null):void 0;return t.createElement(v.Select,{id:"roles",disabled:D,error:R,hint:r,label:s,name:"roles",onChange:z=>{_({target:{name:"roles",value:z}})},placeholder:i,multi:!0,startIcon:ee,value:w,withTags:!0,required:!0},(j||[]).map(z=>t.createElement(v.Option,{key:z.id,value:z.id},B({id:`global.${z.code}`,defaultMessage:z.name}))))};b.defaultProps={disabled:!1,error:void 0},b.propTypes={disabled:c().bool,error:c().string,onChange:c().func.isRequired,value:c().array.isRequired};const Z=b},29168:(k,A,e)=>{e.d(A,{YM:()=>R,Rw:()=>K});var t=e(5173),o=e(484),c=Object.defineProperty,L=Object.defineProperties,v=Object.getOwnPropertyDescriptors,P=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,y=(s,r,i)=>r in s?c(s,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[r]=i,O=(s,r)=>{for(var i in r||(r={}))m.call(r,i)&&y(s,i,r[i]);if(P)for(var i of P(r))C.call(r,i)&&y(s,i,r[i]);return s},x=(s,r)=>L(s,v(r));const S={firstname:t.Z_().trim().required(o.translatedErrors.required),lastname:t.Z_(),email:t.Z_().email(o.translatedErrors.email).lowercase().required(o.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,o.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,o.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(s,r)=>s?r.required(o.translatedErrors.required):r)},K=x(O({},S),{currentPassword:t.Z_().when(["password","confirmPassword"],(s,r,i)=>s||r?i.required(o.translatedErrors.required):i),preferedLanguage:t.Z_().nullable()}),V={roles:t.IX().min(1,o.translatedErrors.required).required(o.translatedErrors.required)};var F=Object.defineProperty,b=Object.defineProperties,Z=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,w=(s,r,i)=>r in s?F(s,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[r]=i,U=(s,r)=>{for(var i in r||(r={}))M.call(r,i)&&w(s,i,r[i]);if(D)for(var i of D(r))_.call(r,i)&&w(s,i,r[i]);return s},j=(s,r)=>b(s,Z(r));const R=t.Ry().shape(U(j(U({},S),{isActive:t.Xg()}),V))},27732:(k,A,e)=>{e.d(A,{Z:()=>C});var t=e(32735),o=e(5636),c=e(60216),L=e.n(c),v=e(83864),P=e(68325);const m=({registrationToken:y})=>{const{formatMessage:O}=(0,o.useIntl)();return y?t.createElement(P.Z,{target:`${window.location.origin}${v.Z}auth/register?registrationToken=${y}`},O({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(P.Z,{target:`${window.location.origin}${v.Z}auth/login`},O({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};m.defaultProps={registrationToken:""},m.propTypes={registrationToken:L().string};const C=m}}]);
